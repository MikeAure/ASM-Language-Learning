assume cs:code, ds:data, ss:stack

data segment
  db '1975','1976','1977','1978','1979','1980','1981','1982','1983'
  db '1984','1985','1986','1987','1988','1989','1990','1991','1992'
  db '1993','1994','1995'
  ;ä»¥ä¸Šæ˜¯è¡¨ç¤º21å¹´çš„21ä¸ªå­—ç¬¦ä¸²

  dd 16,22,382,1356,2390,8000,16000,24486,50065,97479,140317,197514
  dd 345980,590827,803530,1183000,1843000,2759000,3753000,4649000,5937000
  ;ä»¥ä¸Šè¡¨ç¤º21å¹´å…¬å¸æ€»æ”¶å…¥çš„21ä¸ªdwordå‹æ•°æ®

  dw 3,7,9,13,28,38,130,220,476,778,1001,1442,2258,2793,4037,5635,8226
  dw 11542,14430,15257,17800
  ;ä»¥ä¸Šæ˜¯è¡¨ç¤º21å¹´å…¬å¸é›‡å‘˜äººæ•°çš„21ä¸ªwordå‹æ•°æ®
data ends

table segment
  db 21 dup ('year summ ne ?? ')
table ends

stack segment
    db 16 dup(0)
stack ends

code segment

    start:  mov ax, data
            mov ds, ax
            mov bx, 0h
            mov ax, stack 
            mov ss, ax
            mov sp, 10h
            mov cx, 15h
            mov si, 0   ;æ•°æ®æ•°ç»„æŒ‡é’ˆ
            mov ax, table
            mov es, ax  ;esä¸ºtableè¡¨æŒ‡é’ˆ

        year:             ;å°†å¹´ä»½å¾ªç¯è¾“å…¥è¡¨ä¸­
            push cx
            mov cx, 4h  ;å†…å±‚å¾ªç¯å››æ¬¡ï¼Œé€å­—èŠ‚å‘è¡¨å…¬å¸æˆå‘˜æ‰€åœ¨çš„å†…å­˜å¤åˆ¶å†…å®¹
            mov di, 0h  ;æŒ‡å‘è¡¨ä¸­å…¬å¸æˆå‘˜ç‰¹å®šå­—èŠ‚
            loop1:  
                mov al, [si]
                mov es:[bx].0[di], al
                inc si
                inc di        
            loop loop1

            pop cx
            
            add bx,10h
        loop year

        mov cx, 15h
        mov bx, 0h

        ;mov di, 0
        income:

            push cx
            mov cx, 4h  ;å†…å±‚å¾ªç¯å››æ¬¡ï¼Œé€å­—èŠ‚å‘è¡¨å…¬å¸æˆå‘˜æ‰€åœ¨çš„å†…å­˜å¤åˆ¶å†…å®¹
            mov di, 0h
            loop2:

                mov al, [si]
                mov es:[bx].5[di], al
                inc si
                inc di

            loop loop2
            pop cx
            add bx, 10h

        loop income

        mov cx, 15h
        mov bx, 0h

        people:


            push cx
            mov cx, 2h  ;å†…å±‚å¾ªç¯ä¸¤æ¬¡
            mov di, 0h
            loop3:

                mov al, [si]
                mov es:[bx].10[di], al
                inc si
                inc di

            loop loop3

            pop cx
            add bx, 10h
        
        loop people

        mov bx, 0h
        mov cx, 15h

        average:

            ;push cx
            ;mov cx, 40h
            mov di, 0h

            mov ax, word ptr es:[bx].5[di]
            mov dx, word ptr es:[bx].5[di+2]
            push cx
            mov cx, es:[bx].10[di]
            call divdw
            mov es:[bx].13[di], ax
            pop cx
            add bx, 10h

        loop average

        mov cx, 21
        mov bx, 0
        dispre:

            mov byte ptr es:[bx].4, 0
            mov byte ptr es:[bx].9, 0
            mov byte ptr es:[bx].12, 0
            add bx, 10h

        loop dispre
            
        mov bx, 0
        mov ax, es
        mov ds, ax
        mov cx, 21

        mov dh, 5
        mov dl, 5
        mov si, 0

        dis_year:

            push cx



            mov cx, 2

            call show_str
            inc dh
            add si, 10h

            pop cx
        
        loop dis_year

        mov bx, 0
        mov ax, data
        mov ds, ax
        mov si, 0
        mov ax, table
        mov es, ax
        mov dh, 5
        mov dl, 15
        mov cx, 21

        dis_income:

            push cx
            push dx
            mov ax, word ptr es:[bx].5
            mov dx, word ptr es:[bx].7
            call dwtoc

            pop dx
            mov cx,2
            call show_str
            inc dh
            add bx, 10h
            pop cx
        loop dis_income

        mov bx, 0
        mov ax, data
        mov ds, ax
        mov si, 0
        mov ax, table
        mov es, ax
        mov dh, 5
        mov dl, 25
        mov cx, 21

        
        dis_employee:

            push cx
            push dx
            mov ax, word ptr es:[bx].10
            mov dx, 0
            call dwtoc

            pop dx
            mov cx,2
            call show_str
            inc dh
            add bx, 10h
            pop cx
        loop dis_employee

        mov bx, 0
        mov ax, data
        mov ds, ax
        mov si, 0
        mov ax, table
        mov es, ax
        mov dh, 5
        mov dl, 35
        mov cx, 21

        
        dis_aver:

            push cx
            push dx
            mov ax, word ptr es:[bx].13
            mov dx, 0
            call dwtoc

            pop dx
            mov cx,2
            call show_str
            inc dh
            add bx, 10h
            pop cx
        loop dis_aver

    mov ax, 4c00h
    int 21h

    divdw:

        push bx
        push ax
        mov ax, dx
        mov dx, 0
        div cx
        mov bx, ax
        pop ax
        div cx
        mov cx, dx                  ;å­˜å‚¨è®¡ç®—ç»“æœçš„ä½™æ•°
        mov dx,bx
        pop bx
        ret

    show_str:

        push dx                 ;ä¿å­˜è¡Œå·åˆ—å·
        push ax
        push es
        push bx
        push si
        push di
        push cx
        
    
        mov ax, 0b800h  
        mov es, ax              ;ä¿å­˜æ˜¾ç¤ºåŒºåŸŸçš„é¦–åœ°å€

        sub dh, 1               ;è¡Œå·åˆ—å·å‡ä¸€ä¾¿äºæ¥ä¸‹æ¥è®¡ç®—æ˜¾ç¤ºåŒºåŸŸqçš„åç§»é‡
        sub dl, 1

        mov al, 0a0h            ;è®¡ç®—è¡Œåç§»é‡
        mul dh
        push ax                 ;ä¿å­˜è¡Œåç§»é‡
        mov al, 2h              ;è®¡ç®—åˆ—åç§»é‡
        mul dl
        pop dx                  ;æ¢å¤è¡Œåç§»é‡ï¼Œå¹¶ä¸åˆ—åç§»é‡ç´¯åŠ 
        add ax, dx              
        mov di, ax              ;å°†æ˜¾ç¤ºåŒºåŸŸçš„æ€»åç§»é‡ä¿å­˜è‡³å˜å€å¯„å­˜å™¨di
        mov ah, cl              ;å°†å­—ç¬¦ä¸²æ ¼å¼å‚æ•°ä¿å­˜è‡³bl

    display:

        mov ch, 0               ;chå¯„å­˜å™¨ç”¨äºåˆ¤æ–­ä½•æ—¶é€€å‡ºå¾ªç¯
        mov cl, [si]         ;é«˜8ä½ä¸º0ï¼Œä½8ä½ä¸ºå½“å‰å­—ç¬¦ï¼Œé‡0åœæ­¢
        jcxz ok2
        mov al, data:[si]   
        mov word ptr es:[di], ax    ;ç§»è‡³æ˜¾ç¤ºåŒºåŸŸå†…å­˜
        inc si                      ;æŒ‡å‘æ•°æ®åŒºä¸‹ä¸€ä¸ªå­—èŠ‚
        add di, 2                   ;æŒ‡å‘æ˜¾ç¤ºåŒºä¸‹ä¸¤ä¸ªå­—èŠ‚
        jmp short display           ;å¾ªç¯

    ok2:

        pop cx
        pop di
        pop si
        pop bx
        pop es
        pop ax
        pop dx                    ;æ¢å¤dxå€¼ï¼Œæ¸…ç©ºæ ˆ
        ret

    dwtoc:
        push bx
        push cx
        push ax
        push si
        push di
        mov di, 0

    ok4:

        mov cx, 10
        call divdw
        add cx, 30h
        push cx
        inc di
        cmp dx, 0       ;æ­¤å¤„ç”¨cmpï¼Œå®åœ¨ä¸çŸ¥é“æ€ä¹ˆç”¨jcxzğŸ¤¦â€
        je cmp_ax
        jmp ok4

    cmp_ax:

        cmp ax, 0
        je last2
        jmp ok4
    last2:

        ;add cx, 30h    ;ç”¨cmpå°±ä¸å¿…åƒdtocé‚£æ ·å†ä¿å­˜ä¸€é
        ;push cx
        ; inc si

        mov cx, di

    sk:

        pop ds:[si]
        inc si
        loop sk

    exit_dwtoc:

        pop di
        pop si
        pop ax
        pop cx
        pop bx
        ret

    code ends

end start


        
